<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" type="text/css" href="mmap-style.css">
    <title>I Solumnly Swear That I am Up to No Good</title>
    <meta charset="utf-8" />
    <script src="http://maps.googleapis.com/maps/api/js?sensor=true&amp;libraries=places"></script>
</head>
<body>
    <div id="mmap"></div>
    <div id="sidebar"><div id="intro">Messrs. Moony, Wormtail, Padfoot, and Prongs<br />Purveyors of Aids to Magical Mischief-Makers<br /><span class="smalltext">are proud to present</span><br /><span class="titletext">THE MARAUDER'S MAP</span></div><div id="locations"></div></div>

    <script>
    var map;
    function addCharMarker(character){
        var pos = character.loc;
        var mark = new google.maps.Marker({
            position: new google.maps.LatLng(pos.latitude, pos.longitude),
            map: map,
            title: character.name
        });
        var text = "Name: " + character.name + "<br />"
                 + "Latitude: " + pos.latitude + "<br />"
                 + "Longitude: " + pos.longitude + "<br />"
                 + "Note: " + character.note;
        var info = new google.maps.InfoWindow({
            content: text
        });
        google.maps.event.addListener(mark, 'click', function() {
            info.open(map, mark);
        });
    }

    function addCharacters(characterList) {
        for (var i = 0; i < characterList.length; i++) {
            addCharMarker(characterList[i]);
        }
    }
    function addStudents(studentList) {

    }

    function send_location(position) {
        var locationGetter = new XMLHttpRequest();
        locationGetter.open("post", "http://chickenofthesea.herokuapp.com/sendLocation", true);
        locationGetter.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        locationGetter.onreadystatechange = function() {
            if (locationGetter.readyState == 4) {
                var response = JSON.parse(locationGetter.responseText);
                addCharacters(response.characters);
                addStudents(response.students);
            }
        }
        locationGetter.send("login=JimmyValmer" + 
                            "&lat=" + position.coords.latitude +
                            "&lng=" + position.coords.longitude);
    }

    function initialize() {
        var mapOptions = {
            center: { lat: 42.4069, lng: -71.1198},
            zoom: 14
        };
        map = new google.maps.Map(document.getElementById("mmap"),
            mapOptions);
    }
    google.maps.event.addDomListener(window, 'load', initialize);
    navigator.geolocation.getCurrentPosition(send_location);
    </script>
</body>
</html>
